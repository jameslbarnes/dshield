# D-Shield Docker Compose for Phala d-stack deployment
# This file is used by Phala Cloud to deploy the D-Shield runtime

version: "3.8"

services:
  dshield:
    image: ghcr.io/jameslbarnes/dshield:latest
    ports:
      - "3000:3000"
    environment:
      # Runtime configuration
      - DSHIELD_PORT=3000
      - NODE_ENV=production

      # Function configuration (can be overridden)
      - DSHIELD_FUNCTIONS_PATH=/app/functions

      # Firestore configuration (for production log storage)
      # - FIRESTORE_PROJECT_ID=your-project-id
      # - GOOGLE_APPLICATION_CREDENTIALS=/app/credentials.json

      # API keys for functions (encrypted by d-stack)
      # - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}

    # Healthcheck using wget (curl may not be installed)
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
